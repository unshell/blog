<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Unshell&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Unshell的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Unshell&#39;s Blog">
<meta property="og:url" content="https://unshell.github.io/index.html">
<meta property="og:site_name" content="Unshell&#39;s Blog">
<meta property="og:description" content="Unshell的个人博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Unshell">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="Unshell&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/blog/favicon.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Unshell&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">开始，我们以为自己什么都知道。后来发现，其实我们什么都不知道。</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">home</a>
        
          <a class="main-nav-link" href="/blog/archives">archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://unshell.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Tomcat常用配置项" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/01/04/Tomcat%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9/" class="article-date">
  <time datetime="2020-01-04T10:52:53.000Z" itemprop="datePublished">2020-01-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/01/04/Tomcat%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9/">Tomcat 常用配置项</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h3><ul>
<li>基础Java运行环境（JDK 1.8）</li>
<li>Windows<h3 id="修改端口号"><a href="#修改端口号" class="headerlink" title="修改端口号"></a>修改端口号</h3>conf &gt; server.xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Catalina"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8009"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>port ：端口号</li>
<li>protocol ：服务协议（HTTP / AJP）</li>
<li>connectionTimeout ：连接超时（毫秒）</li>
<li>redirectPort ：端口重定向</li>
</ul>
<p>注意：端口范围 1 ~ 65535</p>
<h3 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h3><table>
<thead>
<tr>
<th>内存</th>
<th>内容</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>堆内存</td>
<td>类、数组、实例化的对象</td>
<td>最小为物理内存的1/64，最大为物理内存的1/4</td>
</tr>
<tr>
<td>栈内存</td>
<td>局部变量</td>
<td></td>
</tr>
<tr>
<td>静态内存区</td>
<td>常量、静态变量、meta数据（属性、方法）</td>
<td>默认21m，最大值无上限</td>
</tr>
</tbody></table>
<blockquote>
<p>修改内存配置，应对内存溢出异常（OutofMemoryError）</p>
</blockquote>
<h6 id="内存异常"><a href="#内存异常" class="headerlink" title="内存异常"></a>内存异常</h6><ul>
<li>Java heap space 异常</li>
<li>PermGen space 异常（JDK 8 以下）</li>
<li>StackOverflowError 异常<h6 id="内存配置"><a href="#内存配置" class="headerlink" title="内存配置"></a>内存配置</h6>bin &gt;  catalina.bat<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line"><span class="comment">// 方法一 ：直接在第二行加下一行</span></span><br><span class="line">JAVA_OPTS=<span class="string">"-server -Xms256m -Xmx512m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m"</span></span><br><span class="line"></span><br><span class="line">&lt;!-- 下面也有地方设置 --&gt;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="string">"%JSSE_OPTS%"</span> == <span class="string">""</span> <span class="keyword">goto</span> gotJsseOpts</span><br><span class="line"><span class="built_in">set</span> JSSE_OPTS=<span class="string">"-Djdk.tls.ephemeralDHKeySize=2048"</span></span><br><span class="line">:gotJsseOpts</span><br><span class="line"><span class="comment">// 方法二</span></span><br><span class="line"><span class="built_in">set</span> <span class="string">"JAVA_OPTS=%JAVA_OPTS% %JSSE_OPTS%"</span></span><br></pre></td></tr></table></figure></li>
<li>Xms : Java Heap Initial Size <code>堆初始化大小</code></li>
<li>Xmx : Java Heap Max <code>堆最大值</code></li>
<li>MetaspaceSize : Initial Meta Space Size <code>元空间初始大小</code></li>
<li>MaxMetaspaceSize : Meta Space Max <code>元空间最大值</code></li>
</ul>
<blockquote>
<p>Java 虚拟机(JVM) 的堆大小决定垃圾回收的频率</p>
</blockquote>
<h3 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h3><h6 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h6><p>conf &gt; server.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Service</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Engine</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Host</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Context</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">docBase</span>=<span class="string">"E:\test\web"</span> <span class="attr">path</span>=<span class="string">"/test"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>debug : 关联日志信息，值越大内容越详细</li>
<li>docBase : 项目的绝对路径或相对路径（相对于webapps）</li>
<li>path : 项目后的字符串</li>
<li>reloadable<h6 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h6>conf &gt; Catalina &gt; localhost<br>新建一个<code>xml</code>文件，名称就是方法一的<code>path</code>字段<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"E:\test\web"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Web管理界面"><a href="#Web管理界面" class="headerlink" title="Web管理界面"></a>Web管理界面</h3><img src="/blog/css/images/article/tomcat/01.png" alt="Tomcat 管理界面"><br>这里作为示例，点击 Manager App  ，登入（之前账号和密码需要配置）<br><img src="/blog/css/images/article/tomcat/02.png" alt="Web 管理界面"></li>
</ul>
<h6 id="密码配置"><a href="#密码配置" class="headerlink" title="密码配置"></a>密码配置</h6><p>conf &gt; tomcat-users.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  &lt;role rolename="tomcat"/&gt;</span></span><br><span class="line"><span class="comment">  &lt;role rolename="role1"/&gt;</span></span><br><span class="line"><span class="comment">  &lt;user username="tomcat" password="&lt;must-be-changed&gt;" roles="tomcat"/&gt;</span></span><br><span class="line"><span class="comment">  &lt;user username="both" password="&lt;must-be-changed&gt;" roles="tomcat,role1"/&gt;</span></span><br><span class="line"><span class="comment">  &lt;user username="role1" password="&lt;must-be-changed&gt;" roles="role1"/&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"tomcat"</span> <span class="attr">password</span>=<span class="string">"123456"</span> <span class="attr">roles</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>注释为示例，是对账号管理和认证授权的配置<br>这里我们配置角色<code>manager-gui</code>，账号：tomcat 密码：123456</p>
<h3 id="Tomcat-安全相关配置"><a href="#Tomcat-安全相关配置" class="headerlink" title="Tomcat 安全相关配置"></a>Tomcat 安全相关配置</h3><h6 id="关闭服务器端口"><a href="#关闭服务器端口" class="headerlink" title="关闭服务器端口"></a>关闭服务器端口</h6><p>conf &gt; server.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8005"</span> <span class="attr">shutdown</span>=<span class="string">"QUT"</span>&gt;</span><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里关闭端口为<code>8005</code>，命令这里为<code>QUT</code>（修改默认）</p>
<h6 id="修改版本号"><a href="#修改版本号" class="headerlink" title="修改版本号"></a>修改版本号</h6><p>lib &gt; catalina.jar &gt; org &gt; apache &gt; catalina &gt; util &gt; ServerInfo.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">//</span> <span class="string">修改 info</span></span><br><span class="line"><span class="meta">server.info</span>=<span class="string">Apache Tomcat / 7.0.82</span></span><br><span class="line"><span class="meta">server.number</span>=<span class="string">7.0.82.0</span></span><br><span class="line"><span class="meta">server.built</span>=<span class="string">Sep 29 2017 12:23:15 UTC</span></span><br></pre></td></tr></table></figure>
<h6 id="禁用管理界面"><a href="#禁用管理界面" class="headerlink" title="禁用管理界面"></a>禁用管理界面</h6><p>管理界面定向文件为 webapp &gt; ROOT 文件夹，所以重命名ROOT，新建一个空ROOT。</p>
<h6 id="自定义报错页面"><a href="#自定义报错页面" class="headerlink" title="自定义报错页面"></a>自定义报错页面</h6><p>conf &gt; web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 在 web-app 下 添加 error-page --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error-404.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>如需配置其他状态，格式一样</code></p>
<h6 id="HttpOnly"><a href="#HttpOnly" class="headerlink" title="HttpOnly"></a>HttpOnly</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启 HttpOnly --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">useHttpOnly</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">WatchedResource</span>&gt;</span>WEB-INF/web.xml<span class="tag">&lt;/<span class="name">WatchedResource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://unshell.github.io/2020/01/04/Tomcat%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9/" data-id="ck51qify20001jgsmgdv987vg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Tomcat/" rel="tag">Tomcat</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CodeFrist" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/01/04/CodeFrist/" class="article-date">
  <time datetime="2020-01-04T10:46:51.000Z" itemprop="datePublished">2020-01-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/01/04/CodeFrist/">Entity Framework - Code Frist</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在关系数据库中，不同表之间往往不是全部都单独存在，而是相互存在关联的。两个不同表之间可以存在外键依赖关系，一个表自身也可以有自反关系(表中的一个字段引用主键，从而也是外键字段)。</p>
<h3 id="外键列名默认约定"><a href="#外键列名默认约定" class="headerlink" title="外键列名默认约定"></a>外键列名默认约定</h3><p><strong>一对多关系：</strong>以产品类<code>Product</code>和类别类<code>Gategory</code>为例，一个类别对应多个产品。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 产品类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Product</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 产品编号</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ProductID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 产品名称</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> ProductName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 产品价格</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">decimal</span>? UnitPrice &#123; <span class="keyword">get</span>; <span class="keyword">set</span>;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 产品数量</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>? Quantity &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 分类编号</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> CategoryID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 分类属性-关系</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> Category Category &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以看到<code>Product 类</code>中定义了<code>Category 类</code>作为主键属性。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 类别类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Category</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 类别编号</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> CategoryID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 类别名称</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> CategoryName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 产品集</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> ICollection&lt;Product&gt; Products &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>同样的，<code>Category 类</code>中也定义了<code>Product 类</code>的集合属性。</p>
</blockquote>
<p>说明：在<code>Category 类</code>及<code>Product 类</code>中的引用属性及集合属性前加<code>virtual</code>修饰，为的是<code>Entity Framework Code First</code>的延迟加载功能。不使用<code>virtual</code>修饰，在<code>Category 类</code>的一个实例要查询包含的<code>Product</code>实例时，将不会启用延迟加载。当然<code>Entity Framework Code First</code>延迟加载并不是必须的，所以<code>virtual</code>修饰符也可以不加。<br>　　在定义以上两个类之后，不再添加任何的Entity Framework Code First与数据库的映射配置，运行之后，生成的数据表结构为：<br><img src="/blog/css/images/article/codefirst/01.png" alt="数据表结构"><br>　　从生成的<code>Categories</code>与<code>Products</code>表结构可以看出，在<code>Products</code>表中的外键<code>CategoryID</code>与引用的表<code>Categories</code>主键名称相同。<br>在数据库中生成的Products表，查看外键<code>FK_dbo.Products_dbo.Categories_CategoryID</code>属性，其的确有启用级联删除功能。<br><img src="/blog/css/images/article/codefirst/02.png" alt="外键关系-级联"></p>
<blockquote>
<p>级联：当删除Categories表中一条记录时，数据库会自动联带删除<code>Products</code>表中属于该类别的记录。</p>
</blockquote>
<p>除了这种方式以外还有<code>Data Annotations</code>和<code>Fluent API</code>两种方式实现。<br>还是以<code>Product类</code>和<code>Category类</code>为例子：</p>
<ol>
<li><strong>Data Annotations 配置外键</strong><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> CatID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">[<span class="meta">ForeignKey(<span class="meta-string">"CatID"</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">virtual</span> Category Category &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br></pre></td></tr></table></figure>
或者<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">ForeignKey(<span class="meta-string">"Category"</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> CatID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">virtual</span> Category Category &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br></pre></td></tr></table></figure>
这里的<code>CatID</code>为<code>CategoryID</code>的简写用做演示，可更改。<br>需要引用：<code>using System.ComponentModel.DataAnnotations.Schema;</code></li>
<li><strong>Fluent API 配置关系</strong><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">DbModelBuilder modelBuilder</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//禁用所有一对多表中存在的联级关系</span></span><br><span class="line">    <span class="comment">//modelBuilder.Conventions.Remove&lt;OneToManyCascadeDeleteConvention&gt;();</span></span><br><span class="line"></span><br><span class="line">    modelBuilder.Entity&lt;Category&gt;()</span><br><span class="line">        .HasMany(t =&gt; t.Products)</span><br><span class="line">        .WithRequired(t =&gt; t.Category)</span><br><span class="line">        .HasForeignKey(d =&gt; d.CatID);</span><br><span class="line"></span><br><span class="line">    modelBuilder.Entity&lt;Product&gt;()</span><br><span class="line">        .HasRequired(t =&gt; t.Category)</span><br><span class="line">        .WithMany(t =&gt; t.Products)</span><br><span class="line">        .HasForeignKey(d =&gt; d.CatID)</span><br><span class="line">    <span class="comment">//  .WillCascadeOnDelete(false); //禁用联级</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在<code>OnModelCreating</code>中只添加对Product实体类的关系映射配置，好处就是关系配置和实体类分离，使得关系清晰。<br>注：<code>不清楚关系看下面的引文</code></p>
</blockquote>
</li>
</ol>
<p>当然这种分离还可以依靠继承<code>EntityTypeConfiguration</code>来做到。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引用</span></span><br><span class="line"><span class="keyword">using</span> System.Data.Entity.ModelConfiguration;</span><br><span class="line"></span><br><span class="line">public class ProductMap : EntityTypeConfiguration&lt;Product&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProductMap</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// 主键</span></span><br><span class="line">        <span class="keyword">this</span>.HasKey(t =&gt; t.ProductID);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 特性</span></span><br><span class="line">        <span class="keyword">this</span>.Property(t =&gt; t.ProductName)</span><br><span class="line">            .IsRequired()</span><br><span class="line">            .HasMaxLength(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 表名</span></span><br><span class="line">        <span class="keyword">this</span>.ToTable(<span class="string">"Product"</span>);</span><br><span class="line">        <span class="keyword">this</span>.Property(t =&gt; t.ProductID).HasColumnName(<span class="string">"ProductID"</span>);</span><br><span class="line">        <span class="keyword">this</span>.Property(t =&gt; t.CategoryID).HasColumnName(<span class="string">"CategoryID"</span>);</span><br><span class="line">        <span class="keyword">this</span>.Property(t =&gt; t.ProductName).HasColumnName(<span class="string">"ProductName"</span>);</span><br><span class="line">        <span class="keyword">this</span>.Property(t =&gt; t.UnitPrice).HasColumnName(<span class="string">"UnitPrice"</span>);</span><br><span class="line">        <span class="keyword">this</span>.Property(t =&gt; t.Quantity).HasColumnName(<span class="string">"Quantity"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 一对多关系</span></span><br><span class="line">        <span class="keyword">this</span>.HasRequired(t =&gt; t.Category)</span><br><span class="line">            .WithMany(t =&gt; t.Products)</span><br><span class="line">            .HasForeignKey(d =&gt; d.CategoryID)</span><br><span class="line">            .WillCascadeOnDelete(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上代码所示：创建一个<code>ProductMap类</code>在里面配置实体类<code>主键</code>、<code>表名</code>、<code>特性</code>和<code>外键关系</code>，之后只要在覆写的<code>OnModelCreating</code>方法中添加就可以了，具体情况如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">DbModelBuilder modelBuilder</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    modelBuilder.Configurations.Add(<span class="keyword">new</span> ProductMap());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然配置特性和主键使用<code>Data Annotations</code>的方式也能做到，代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引用</span></span><br><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations;</span><br><span class="line"><span class="keyword">using</span> System.ComponentModel.DataAnnotations.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 产品编号</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">[<span class="meta">Column(<span class="meta-string">"ProductID"</span>), Key, DatabaseGenerated(DatabaseGeneratedOption.Identity)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> ProductID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 产品名称</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">[<span class="meta">Column(<span class="meta-string">"ProductName"</span>), Required, MaxLength(100)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">string</span> ProductName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="comment">//这里只做演示，不完整</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>个人偏向创建<code>Map.cs</code>的方法，会比较清晰好修改。</p>
</blockquote>
<p><strong>一对一关系：</strong>以<code>User 类</code>和<code>UserProfile 类</code>为例，一个用户对应一个用户简介。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 用户类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">User</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 用户编号</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> UserID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 用户名</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> UserName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 密码</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Password &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 是否有效</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">bool</span>? IsValid &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 用户简介</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> UserProfile UserProfile &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以看到<code>User 类</code>中定义了<code>UserProfile 类</code>作为主键属性。</p>
</blockquote>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 用户信息类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserProfile</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 简介编号</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> ProfileID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 姓名</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 性别</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> Nullable&lt;<span class="keyword">bool</span>&gt; Sex &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 出生日期</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> Nullable&lt;DateTime&gt; Birthday &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 邮箱</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Email &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 电话</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Telephone &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 手机</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Mobilephone &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 地址</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Address &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建时间</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> DateTime? CreateDate &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 用户</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> User User &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>同样的<code>UserProfile 类</code>中定义了<code>User 类</code>作为主键属性。</p>
</blockquote>
<p>在定义以上两个类之后，不再添加任何的Entity Framework Code First与数据库的映射配置，运行之后，生成的数据表结构为：<br><img src="/blog/css/images/article/codefirst/03.png" alt="数据表结构"><br>当然仅为了实现一对一关系的话也可以让<code>UserID</code>做外键，但在真实项目中要明确主外键关系。</p>
<blockquote>
<p>当然通过覆写<code>OnModelCreating</code>方法同样可以做到，这里就不多做演示了。</p>
</blockquote>
<p><strong>多对多关系：</strong>以<code>User 类</code>和<code>Role 类</code>为例，一个用户可能属于多个角色，一个角色可以包含多个用户。<br>添加<code>Role</code>类，代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 角色类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 角色编号</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> RoleID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 角色名</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> RoleName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 用户集</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> ICollection&lt;User&gt; Users &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里<code>User 类</code>和<code>Role 类</code>双方定义对方类的集合属性</p>
</blockquote>
<p>在定义以上两个类之后，不再添加任何的Entity Framework Code First与数据库的映射配置，运行之后，生成的数据表结构为：<br><img src="/blog/css/images/article/codefirst/04.png" alt="数据表结构"></p>
<blockquote>
<p>这里值得注意的是：实体类运行之后，除了生成<code>Users 表</code>和<code>Roles 表</code>之外，还生成了<code>RoleUsers 表</code>作为中介表<code>RoleUsers 表</code>里面包含双方的主键。</p>
</blockquote>
<hr>
<p><strong>一对多自反关系：</strong>以<code>Category 类</code>为例，这种关系大多出现形式为节点<code>Node</code>类，跟文件夹相似。<br>代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Category</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> CategoryID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> CategoryNo &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> CategoryName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>? ParentID &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> Category Parent &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> ICollection&lt;Category&gt; Children &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>类别表通过一个ParentID列保存引用主键，用来实现无限级递归。</p>
</blockquote>
<h3 id="引文"><a href="#引文" class="headerlink" title="引文"></a>引文</h3><ul>
<li>本文引文：<a href="https://www.cnblogs.com/libingql/p/3353112.html" target="_blank" rel="noopener">Entity Framework Code First关系映射约定</a></li>
<li>推荐文章：<a href="https://www.cnblogs.com/enigmaxp/p/9159391.html" target="_blank" rel="noopener">EntityFrameworkCore2.1的安装使用和其中遇到的那些坑</a></li>
<li>EF实体类配置关系：<a href="https://www.cnblogs.com/Leo_wl/p/3624614.html" target="_blank" rel="noopener">EF实体类配置总结</a></li>
<li>更加详细的文档：<a href="http://www.entityframeworktutorial.net/code-first/dataannotation-in-code-first.aspx" target="_blank" rel="noopener">EntityFramework 文档</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://unshell.github.io/2020/01/04/CodeFrist/" data-id="ck51qifxw0000jgsmbl5f0hpb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/CShaper/" rel="tag">CShaper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Http流程简述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/01/04/Http%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0/" class="article-date">
  <time datetime="2020-01-04T10:35:21.000Z" itemprop="datePublished">2020-01-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/01/04/Http%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0/">Http流程简述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>比如打开Google 浏览器为例：</p>
<ul>
<li>Http客户端发起请求，创建端口<code>默认为80端口</code></li>
<li>Http服务器在端口监听客户端请求</li>
<li>收到请求后，服务器向客户端返回状态<code>如state:200</code>和内容<h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3></li>
</ul>
<p>在浏览器渲染完页面之前需要走的步骤以<code>chrome 浏览器为例</code>：</p>
<ul>
<li>Chrome浏览器搜索自身DNS缓存<code>通过输入chrome://net-internals/#dns</code>可以查看记录，如图：</li>
</ul>
<p><img src="/blog/css/images/article/httphandle/01.png" alt="Chrome浏览器DNS缓存记录"></p>
<ul>
<li>搜索操作系统自身的DNS缓存<code>浏览器没有找到缓存或缓存已经失效</code></li>
<li>读取本地的Host文件<code>系统盘下的System32</code></li>
<li>浏览器发起一个DNS系统调用<code>一般来说是自己的宽带运营商提供</code><ol>
<li>宽带运营商服务器查看本身缓存</li>
<li>运营商服务器代替浏览器发送一个迭代DNS解析请求</li>
<li>域名IP地址以<code>google.com为例</code>：根域&gt;.com域&gt;google.com域</li>
<li>运营商拿到IP地址返回操作系统内核，并缓存在缓存区<code>有失效时间</code></li>
<li>操作系统内核把结果返回浏览器</li>
<li>浏览器拿到 <a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a> 对应的IP地址</li>
</ol>
</li>
<li>域名解析完成后，发起HTTP”三次握手”<ol>
<li>浏览器以一个随机端口向服务器的<br>WEB程序发送TCP请求</li>
<li>TCP请求通过各个路由设备，到达服务器进入到网卡到达内核的TCP/IP协议栈</li>
</ol>
</li>
<li>浏览器向服务器发送请求<code>如HTTP的GET方法</code></li>
<li>服务器端接受到请求，根据路劲参数，把结果数据返回给浏览器<h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3></li>
</ul>
<ol>
<li>能否收到请求</li>
<li>能收到请求，可以开始交互</li>
<li>收到，开始交互</li>
</ol>
<p>当然实际流程要复杂很多，这里只是简单的描述</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://unshell.github.io/2020/01/04/Http%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0/" data-id="ck51qify60003jgsm4i5o8pxv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Http/" rel="tag">Http</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/CShaper/" rel="tag">CShaper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Http/" rel="tag">Http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Tomcat/" rel="tag">Tomcat</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/CShaper/" style="font-size: 10px;">CShaper</a> <a href="/blog/tags/Http/" style="font-size: 10px;">Http</a> <a href="/blog/tags/Tomcat/" style="font-size: 10px;">Tomcat</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/01/">一月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2020/01/04/Tomcat%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9/">Tomcat 常用配置项</a>
          </li>
        
          <li>
            <a href="/blog/2020/01/04/CodeFrist/">Entity Framework - Code Frist</a>
          </li>
        
          <li>
            <a href="/blog/2020/01/04/Http%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0/">Http流程简述</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Unshell<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">

  
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>




<script src="/blog/js/script.js"></script>




  </div>
</body>
</html>